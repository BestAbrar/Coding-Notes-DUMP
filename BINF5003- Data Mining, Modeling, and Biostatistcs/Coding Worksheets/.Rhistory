print(head(sort(standard_deviations, decreasing = TRUE),n=10))
#generating heat map using top 10 most variable attributes
library(RColorBrewer)
row_distance <- dist(as.numeric(as.factor(bCancer$diagnosis)))
row_cluster <- hclust(row_distance, method = "complete")
row_dendrogram <- as.dendrogram(row_cluster)
sorted_abs_loading <- sort(abs(loadings_pc1), decreasing = TRUE)
MostVarAtributes <- bCancer[names(head(sorted_abs_loading, decreasing = TRUE),n=10)]
#finding top 10 greatest variable attributes
ncol = bCancer[,3:32]
standard_deviations <- sapply(ncol, sd)^2
print(head(sort(standard_deviations, decreasing = TRUE),n=10))
#generating heat map using top 10 most variable attributes
library(RColorBrewer)
row_distance <- dist(as.numeric(as.factor(bCancer$diagnosis)))
row_cluster <- hclust(row_distance, method = "complete")
row_dendrogram <- as.dendrogram(row_cluster)
sorted_abs_loading <- sort(abs(loadings_pc1), decreasing = TRUE)
MostVarAtributes <- bCancer[names(head(sorted_abs_loading,n=10)()]
#finding top 10 greatest variable attributes
ncol = bCancer[,3:32]
standard_deviations <- sapply(ncol, sd)^2
print(head(sort(standard_deviations, decreasing = TRUE),n=10))
#generating heat map using top 10 most variable attributes
library(RColorBrewer)
row_distance <- dist(as.numeric(as.factor(bCancer$diagnosis)))
row_cluster <- hclust(row_distance, method = "complete")
row_dendrogram <- as.dendrogram(row_cluster)
sorted_abs_loading <- sort(abs(loadings_pc1), decreasing = TRUE)
MostVarAtributes <- bCancer[names(head(sorted_abs_loading,n=10))]
pheatmap(MostVarAtributes,
annotation_col = anno_colour,
scale = "row",
cutree_cols = 4)
#finding top 10 greatest variable attributes
ncol = bCancer[,3:32]
standard_deviations <- sapply(ncol, sd)^2
print(head(sort(standard_deviations, decreasing = TRUE),n=10))
#generating heat map using top 10 most variable attributes
library(RColorBrewer)
row_distance <- dist(as.numeric(as.factor(bCancer$diagnosis)))
row_cluster <- hclust(row_distance, method = "complete")
row_dendrogram <- as.dendrogram(row_cluster)
sorted_abs_loading <- sort(abs(loadings_pc1), decreasing = TRUE)
MostVarAtributes <- bCancer[names(head(sorted_abs_loading,n=10))]
MostVarAtributes_matrix <- data.matrix(MostVarAtributes)
pheatmap(MostVarAtributes_matrix,
annotation_col = anno_colour,
scale = "row",
cutree_cols = 4)
colour_by_phenotype <- function(pheno){
ggplot(data = pca_mh$x, aes(x = PC1, y = PC2)) +
geom_point(aes(colour = ))
}
for (col in names(mental_health)){
colour_by_phenotype(col)
}
mental_health <- read.csv(here("DB_mini.csv"), header = TRUE)
names(mental_health)
# remove participant number, not a true phenotype
# then run PCA
pca_mh <- prcomp(mental_health[ , 2:9])
# RQ: How do variables of mental health (openness, restraint, transcendence, and interpersonal skill) influence patient's depression, anxiety and stress after COVID?
# not good RQ
# RQ: How is a patients' mental health affected?
# RQ: What conclusions can we draw from mental health outcomes?
# visualize
# pca$x provides original dataset on new components
ggplot(data = pca_mh$x, aes(x = PC1, y = PC2)) +
geom_point(aes(color = mental_health$Age))
colour_by_phenotype <- function(pheno){
ggplot(data = pca_mh$x, aes(x = PC1, y = PC2)) +
geom_point(aes(colour = ))
}
for (col in names(mental_health)){
colour_by_phenotype(col)
}
colour_by_phenotype(Age)
colour_by_phenotype <- function(pheno){
ggplot(data = pca_mh$x, aes(x = PC1, y = PC2)) +
geom_point(aes(colour = mental_health[pheno]))
}
for (col in names(mental_health)){
colour_by_phenotype(col)
}
colour_by_phenotype(Age)
View(mental_health)
colour_by_phenotype <- function(pheno){
ggplot(data = pca_mh$x, aes(x = PC1, y = PC2)) +
geom_point(aes(colour = mental_health[pheno]))
}
for (col in names(mental_health)){
colour_by_phenotype(col)
}
# check pvalue & differentially expressed value
top25_ra$diff <- top25_ra$adj.P.Val < 0.01 & abs(top25_ra$logFC < 0.5)
# dataframe to colour by
anno_colour <- data.frame(pheno = pData(gset_ra)$characteristics_ch1.2,
batch = pData(gset_ra)$submission_date,
row.names = colnames(gset_ra))
# index expression table using only top 25 genes
gset_ra_25 <- gset_ra[rownames(gset_ra) %in% rownames(top25_ra), ]
# heatmap
pheatmap(gset_ra_25,
annotation_col = anno_colour,
scale = "row",
cutree_cols = 4)
#finding top 10 greatest variable attributes
ncol = bCancer[,3:32]
standard_deviations <- sapply(ncol, sd)^2
print(head(sort(standard_deviations, decreasing = TRUE),n=10))
#generating heat map using top 10 most variable attributes
library(RColorBrewer)
row_distance <- dist(as.numeric(as.factor(bCancer$diagnosis)))
row_cluster <- hclust(row_distance, method = "complete")
row_dendrogram <- as.dendrogram(row_cluster)
sorted_abs_loading <- sort(abs(loadings_pc1), decreasing = TRUE)
MostVarAtributes <- bCancer[names(head(sorted_abs_loading,n=10))]
MostVarAtributes_matrix <- data.matrix(MostVarAtributes)
anno_colour <- data.frame(diagnosis = bCancer$diagnosis
row.names = colnames(MostVarAtributes))
#finding top 10 greatest variable attributes
ncol = bCancer[,3:32]
standard_deviations <- sapply(ncol, sd)^2
print(head(sort(standard_deviations, decreasing = TRUE),n=10))
#generating heat map using top 10 most variable attributes
library(RColorBrewer)
row_distance <- dist(as.numeric(as.factor(bCancer$diagnosis)))
row_cluster <- hclust(row_distance, method = "complete")
row_dendrogram <- as.dendrogram(row_cluster)
sorted_abs_loading <- sort(abs(loadings_pc1), decreasing = TRUE)
MostVarAtributes <- bCancer[names(head(sorted_abs_loading,n=10))]
MostVarAtributes_matrix <- data.matrix(MostVarAtributes)
anno_colour <- data.frame(diagnosis = bCancer$diagnosis,
row.names = colnames(MostVarAtributes))
#finding top 10 greatest variable attributes
ncol = bCancer[,3:32]
standard_deviations <- sapply(ncol, sd)^2
print(head(sort(standard_deviations, decreasing = TRUE),n=10))
#generating heat map using top 10 most variable attributes
library(RColorBrewer)
row_distance <- dist(as.numeric(as.factor(bCancer$diagnosis)))
row_cluster <- hclust(row_distance, method = "complete")
row_dendrogram <- as.dendrogram(row_cluster)
sorted_abs_loading <- sort(abs(loadings_pc1), decreasing = TRUE)
MostVarAtributes <- bCancer[names(head(sorted_abs_loading,n=10))]
MostVarAtributes_matrix <- data.matrix(MostVarAtributes)
anno_colour <- data.frame(diagnosis = bCancer$diagnosis,
row.names = names(MostVarAtributes))
#finding top 10 greatest variable attributes
ncol = bCancer[,3:32]
standard_deviations <- sapply(ncol, sd)^2
print(head(sort(standard_deviations, decreasing = TRUE),n=10))
#generating heat map using top 10 most variable attributes
library(RColorBrewer)
row_distance <- dist(as.numeric(as.factor(bCancer$diagnosis)))
row_cluster <- hclust(row_distance, method = "complete")
row_dendrogram <- as.dendrogram(row_cluster)
sorted_abs_loading <- sort(abs(loadings_pc1), decreasing = TRUE)
MostVarAtributes <- bCancer[names(head(sorted_abs_loading,n=10))]
MostVarAtributes_matrix <- data.matrix(MostVarAtributes)
anno_colour <- data.frame(diagnosis = bCancer$diagnosis)
pheatmap(MostVarAtributes_matrix,
annotation_col = anno_colour,
scale = "row",
cutree_cols = 4)
bCancer <- read.csv("breastCancer.csv", header = T)
pca_bCancer <- prcomp(bCancer[ , 3:32])
length(pca_bCancer$sdev)
#there are 30 principal components
variance_bCancer = pca_bCancer$sdev^2
# proportion variance
variance_bCancer / sum(variance_bCancer) -> prop_bCancer
# plot variance in a scree plot
plot(prop_bCancer,
xlab = "Principal Components",
ylab = "Proportion of Variance Explained",
ylim = c(0, 1))
#percentage variance for each PC
print((variance_bCancer[1]+variance_bCancer[2])/sum(variance_bCancer))
#'first and second component make up 99.8% of the total variance (explain 63.2% of
#'the variance)
library(ggplot2)
pca_bCancer$diagnosis = bCancer$diagnosis
ggplot(pca_bCancer$x, aes(x = PC1, y = PC2)) +
geom_point(aes(colour = pca_bCancer$diagnosis))+
labs(title="PCA analysis of bCancer with Diagnosis")
loadings_pc1 <- pca_bCancer$rotation[, "PC1"]
sorted_loadings_pc1 <- sort(loadings_pc1, decreasing = TRUE)
print(head(sorted_loadings_pc1,n=5))
#'the 5 variables most strongly contributing to the positive values in PC1 are:
#'1. smoothness_se
#'2. texture_se
#'3. symmetry_se
#'4. fractal_dimension_mean
#'5. fractal_dimension_se
#'in order from greatest to least
bCancer <- read.csv("breastCancer.csv", header = T)
pca_bCancer <- prcomp(bCancer[ , 3:32])
length(pca_bCancer$sdev)
#there are 30 principal components
variance_bCancer = pca_bCancer$sdev^2
# proportion variance
variance_bCancer / sum(variance_bCancer) -> prop_bCancer
# plot variance in a scree plot
plot(prop_bCancer,
xlab = "Principal Components",
ylab = "Proportion of Variance Explained",
ylim = c(0, 1))
#percentage variance for each PC
print((variance_bCancer[1]+variance_bCancer[2])/sum(variance_bCancer))
#'first and second component make up 99.8% of the total variance (explain 63.2% of
#'the variance)
library(ggplot2)
pca_bCancer$diagnosis = bCancer$diagnosis
ggplot(pca_bCancer$x, aes(x = PC1, y = PC2)) +
geom_point(aes(colour = pca_bCancer$diagnosis))+
labs(title="PCA analysis of bCancer with Diagnosis")
loadings_pc1 <- pca_bCancer$rotation[, "PC1"]
sorted_loadings_pc1 <- sort(loadings_pc1, decreasing = TRUE)
print(head(sorted_loadings_pc1,n=5))
#'the 5 variables most strongly contributing to the positive values in PC1 are:
#'1. smoothness_se
#'2. texture_se
#'3. symmetry_se
#'4. fractal_dimension_mean
#'5. fractal_dimension_se
#'in order from greatest to least
#finding top 10 greatest variable attributes
ncol = bCancer[,3:32]
standard_deviations <- sapply(ncol, sd)^2
print(head(sort(standard_deviations, decreasing = TRUE),n=10))
#generating heat map using top 10 most variable attributes
library(RColorBrewer)
row_distance <- dist(as.numeric(as.factor(bCancer$diagnosis)))
row_cluster <- hclust(row_distance, method = "complete")
row_dendrogram <- as.dendrogram(row_cluster)
sorted_abs_loading <- sort(abs(loadings_pc1), decreasing = TRUE)
MostVarAtributes <- bCancer[names(head(sorted_abs_loading,n=10))]
MostVarAtributes_matrix <- data.matrix(MostVarAtributes)
anno_colour <- data.frame(diagnosis = bCancer$diagnosis)
pheatmap(MostVarAtributes_matrix,
annotation_col = anno_colour,
scale = "row",
cutree_cols = 4)
bCancer <- read.csv("breastCancer.csv", header = T)
pca_bCancer <- prcomp(bCancer[ , 3:32], scale = TRUE)
length(pca_bCancer$sdev)
#there are 30 principal components
variance_bCancer = pca_bCancer$sdev^2
# proportion variance
variance_bCancer / sum(variance_bCancer) -> prop_bCancer
# plot variance in a scree plot
plot(prop_bCancer,
xlab = "Principal Components",
ylab = "Proportion of Variance Explained",
ylim = c(0, 1))
#percentage variance for each PC
print((variance_bCancer[1]+variance_bCancer[2])/sum(variance_bCancer))
#'first and second component make up 99.8% of the total variance (explain 63.2% of
#'the variance)
library(ggplot2)
pca_bCancer$diagnosis = bCancer$diagnosis
ggplot(pca_bCancer$x, aes(x = PC1, y = PC2)) +
geom_point(aes(colour = pca_bCancer$diagnosis))+
labs(title="PCA analysis of bCancer with Diagnosis")
loadings_pc1 <- pca_bCancer$rotation[, "PC1"]
sorted_loadings_pc1 <- sort(loadings_pc1, decreasing = TRUE)
print(head(sorted_loadings_pc1,n=5))
#'the 5 variables most strongly contributing to the positive values in PC1 are:
#'1. smoothness_se
#'2. texture_se
#'3. symmetry_se
#'4. fractal_dimension_mean
#'5. fractal_dimension_se
#'in order from greatest to least
#finding top 10 greatest variable attributes
ncol = bCancer[,3:32]
standard_deviations <- sapply(ncol, sd)^2
print(head(sort(standard_deviations, decreasing = TRUE),n=10))
#generating heat map using top 10 most variable attributes
library(RColorBrewer)
row_distance <- dist(as.numeric(as.factor(bCancer$diagnosis)))
row_cluster <- hclust(row_distance, method = "complete")
row_dendrogram <- as.dendrogram(row_cluster)
#sorted_abs_loading <- sort(abs(loadings_pc1), decreasing = TRUE)
MostVarAtributes <- bCancer[names(head(sort(standard_deviations, decreasing = TRUE),n=10))]
MostVarAtributes_matrix <- data.matrix(MostVarAtributes)
my_group <- as.numeric(as.factor(bCancer$diagnosis))
colSide <- brewer.pal(9, "Set1")[my_group]
heatmap(MostVarAtributes_matrix, Colv = NA, Rowv = row_dendrogram,
RowSideColors=colSide, scale="column",
margins = c(10, 10),
main='Top 10 variable attributes by bCancer diagnosis',
ylab = 'Sample',
xlab = 'Attribute'
)
legend(x="topright", legend=c("B", "M"),
fill=brewer.pal(9, "Set1"),
inset=c(0,-0.05))
legend(x="bottomright", legend=c("min", "ave", "max"),
fill=colorRampPalette(brewer.pal(8, "Oranges"))(3))
heatmap(MostVarAtributes_matrix, Colv = NA, RowSideColors=colSide, scale="column",
main='Top 10 variable attributes by Cluster density',
ylab = 'Sample',
xlab = 'Attribute',
margins = c(10, 10),
)
legend(x="topright", legend=c("B", "M"),
fill=brewer.pal(9, "Set1"),
inset=c(0,-0.05))
legend(x="bottomright", legend=c("min", "ave", "max"),
fill=colorRampPalette(brewer.pal(8, "Oranges"))(3))
loadings_pc1 <- pca_bCancer$rotation[, "PC1"]
sorted_loadings_pc1 <- sort(loadings_pc1, decreasing = TRUE)
print(head(sorted_loadings_pc1,n=5))
#'the 5 variables most strongly contributing to the positive values in PC1 are:
#'1. smoothness_se
#'2. texture_se
#'3. symmetry_se
#'4. fractal_dimension_mean
#'5. fractal_dimension_se
#'in order from greatest to least
loadings_pc1 <- pca_bCancer$rotation[, "PC1"]
sorted_loadings_pc1 <- sort(loadings_pc1, decreasing = TRUE)
print(slice_max(loadings_pc1,n=5))
librar(dply)
librar(dplyr())
librar(dplyr
loadings_pc1 <- pca_bCancer$rotation[, "PC1"]
librar(dplyr)
library(dplyr)
loadings_pc1 <- pca_bCancer$rotation[, "PC1"]
sorted_loadings_pc1 <- sort(loadings_pc1, decreasing = TRUE)
print(slice_max(loadings_pc1,n=5))
library(dplyr)
loadings_pc1 <- pca_bCancer$rotation[, "PC1"]
sorted_loadings_pc1 <- sort(loadings_pc1, decreasing = TRUE)
print(slice_max(loadings_pc1,n=5))
loadings_pc1 <- pca_bCancer$rotation[, "PC1"]
sorted_loadings_pc1 <- sort(loadings_pc1, decreasing = TRUE)
print(head(sorted_loadings_pc1,n=5))
#'the 5 variables most strongly contributing to the positive values in PC1 are:
#'1. smoothness_se
#'2. texture_se
#'3. symmetry_se
#'4. fractal_dimension_mean
#'5. fractal_dimension_se
#'in order from greatest to least
# get top 50 differentially expressed genes
results_ordered_50 <- head(results_ordered, 50)
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("GEOquery")
BiocManager::install("oligo")
BiocManager::install("limma")
BiocManager::install("hgu133a.db")
BiocManager::install("Biobase")
BiocManager::install("DESeq2")
BiocManager::install("EnhancedVolcano")
BiocManager::install("airway")
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("GEOquery")
library(GEOquery)
library(oligo)
library(limma)
library(hgu133a.db)
library(Biobase)
library(ggplot2)
library(tidyverse)
library(cowplot)
library(ggfortify)
gset <- getGEO("GSE183071", GSEMatrix = TRUE, getGPL = TRUE)
# this line of code checks if there are more than one data files associated with the accession and selects the first one. it also provides the GP or platform ID, the chip version and manufacture such that annotation about the genes is obtained
# will need Internet connection
gset <- gset[[1]]
# this displays the summary of the object
# double square brackets indexes recursively, used for lists within lists
# overwriting object - be careful to only run this once!
gset
class(gset)
str(gset)
library(DESeq2)
dds <- DESeqDataSet(gse, design = ~ donor + condition)
library(DESeq2)
dds <- DESeqDataSet(gse, design = ~ donor + condition)
library(airway)
data("gse")
str(gse)
# assay(gse)
dim(assay(gse)) # 58294 feature genes, 8 samples
rowRanges(gse) # first and last 5 genes in matrix
seqinfo(rowRanges(gse)) # metadata about our sequences
colData(gse) # sample names, as well as the donor ID, and the treatment condition (treated with dexamethasone or untreated)
as.data.frame(colData(gse)) # for readability
library(DESeq2)
dds <- DESeqDataSet(gse, design = ~ donor + condition)
dds # this is our DESeq object
# counts(dds) # access counts data
nrow(dds) # 58294 rows
# keep only rows with at least two counts
# rowSums(counts(dds)) > 1
dds_clean <- dds[rowSums(counts(dds)) > 1, ]
nrow(dds_clean) # 31604 rows
diff_dds <- DESeq(dds_clean)
# coefficients for each gene based on phenotype
head(coef(diff_dds))
# metadata
# mcols(diff_dds)
diff_results <- results(diff_dds)
head(diff_results)
# first, estimate size factors of the dds object and normalize
dds_size <- estimateSizeFactors(dds_clean)
# normalizationFactors(dds_size)
# check with original diff_dds object
# normalizationFactors(diff_dds)
# next, estimate dispersion using size factors
dds_dispersions <- estimateDispersions(dds_size)
# dispersions(dds_dispersions)
# check with original diff_dds object
# dispersions(diff_dds)
# plot dispersion estimates
plotDispEsts(dds_dispersions)
results_ordered <- diff_results[order(diff_results$padj), ]
summary(results_ordered)
sum(diff_results$padj < 0.05, na.rm = TRUE) # 3541 genes are differentially expressed
plotCounts(diff_dds, gene = "ENSG00000285991.1", intgroup = "condition")
# or compare gene expression of gene with lowest p-value
plotCounts(diff_dds, gene = which.min(diff_results$padj),
intgroup = "condition")
# using ggplot
plotCounts(diff_dds, gene = "ENSG00000189221.9", intgroup = "condition",
returnData = TRUE) %>% # from purrr (tidyverse) to return a df to pipe
ggplot(aes(x = condition, y = count)) +
geom_boxplot() +
scale_y_log10()
plotMA(diff_results, ylim = c(-2,2))
library(EnhancedVolcano)
EnhancedVolcano(
diff_results,
lab = rownames(diff_results),
x = "log2FoldChange",
y = "padj",
xlim = c(-10, 10),
title = "Condition-biased gene expression",
pCutoff = 10e-16, # horizontal line
FCcutoff = 1.5, # vertical lines
pointSize = 0.5,
labSize = 2.5,
col = c("black", "black", "black", "red3"),
colAlpha = 1
)
# change the deseq results into a tibble (i.e., a dataframe that tidyverse likes)
diff_results_tibble <- as_tibble(diff_results)
# add a boolean column that indicates whether or not the gene is significantly differentially expressed
diff_results_tibble <- diff_results_tibble %>% mutate(sig = padj < 0.05)
# MA
diff_results_tibble %>%
ggplot(aes(baseMean, log2FoldChange, colour = sig)) +
geom_point() + scale_x_log10() + ggtitle("MA plot")
# volcano
diff_results_tibble %>%
ggplot(aes(log2FoldChange, -1*log10(pvalue), colour = sig)) +
geom_point() + ggtitle("Volcano plot")
# get top 50 differentially expressed genes
results_ordered_50 <- head(results_ordered, 50)
# filter these top 50 genes from original count dataset
top_50 <- dds_clean[rownames(dds_clean) %in% rownames(results_ordered_50), ]
# create df to colour by
anno_colour <- data.frame(row.names = colnames(dds_clean),
treatment = colData(dds_clean)$condition)
# make heatmap
library(pheatmap)
pheatmap(assay(top_50),
scale = "row",
annotation_col = anno_colour,
cutree_cols = 2,
cutree_rows = 4)
# BiocManager::install("parathyroidSE")
library("parathyroidSE")
data("parathyroidGenesSE")
# assay(parathyroidGenesSE)
# save count data into object
para <- assay(parathyroidGenesSE)
# save sample data into object
sample <- colData(parathyroidGenesSE)
# get names of samples using `run` column
colData(parathyroidGenesSE)$run
# save these sample names into columns
colnames(para) <- colData(parathyroidGenesSE)$run
# check all our objects: count matrix and sample data
# para
# sample
para_object <- DESeqDataSetFromMatrix(
countData = para,
colData = sample,
design = ~ patient + treatment
)
para_object_subset <- para_object[ , para_object$time == "48h" ]
# check
para_object_subset
para_object_subset <- para_object[ , para_object$time == "48h" ]
# check
para_object_subset
# check again!
colData(para_object_subset)
# str(para_object_subset)
dim(assay(para_object_subset)) # 63193 genes on 14 samples
para_clean <- para_object_subset[rowSums(counts(para_object_subset)) > 2, ]
dim(assay(para_clean)) # 26222
diff_para <- DESeq(para_clean)
